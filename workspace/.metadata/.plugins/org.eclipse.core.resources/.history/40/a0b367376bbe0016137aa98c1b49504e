import java.awt.Color;
import java.util.ArrayList;
import java.util.Random;

public abstract class Entite {
	private Color couleur;
	protected int abs;
	protected int ord;
	private static boolean[] caseOccupees = new boolean[300];
	protected static Entite[] listeEntites = new Entite[300];
	private char typeEntite; // 'v' pour vaisseaux et 'p' pour planete

	public Entite(Color c){
		Random rand = new Random();
		abs = rand.nextInt(Constantes.Largeur); //abscisse
		ord = rand.nextInt(Constantes.Hauteur); //ordonnée
		while(occupee(abs, ord)){
			abs = rand.nextInt(Constantes.Largeur); //abscisse
			ord = rand.nextInt(Constantes.Hauteur); //ordonnée
		}
		couleur = c ;
		caseOccupees[getNumeroEntite()] = true;
		typeEntite = 'p';
	}

	public Entite(Planetes p,Color c){
		caseAdjacente(p);
		couleur = c;
		caseOccupees[getNumeroEntite()] = true;
		typeEntite = 'v';
	}
	
	public abstract void InfligeDegat(int aRetrancher);
	
	public void modifCouleur(Color newColor){
		couleur = newColor;
	}
	
	public ArrayList<Entite> getListeEntites(){
		return listeEntites;
	}
	
	public void ajoutListeEntite(Entite e){
		listeEntites.add(e.getNumeroEntite(),e);
	}
	
	public void supprListeEntite(Entite e){
		listeEntites.remove(e.getNumeroEntite());
	}
	
	public void modifPositionEntite(int anciennePos, int nouvellePos){
		listeEntites.add(nouvellePos, listeEntites.get(anciennePos));
		listeEntites.remove(anciennePos);
	}
	
	public char getTypeEntite(){
		return typeEntite;
	}
	
	public void caseAdjacente(Planetes p){
		abs = p.getAbscisse()-1;
		ord = p.getOrdonnee()-1;
		recadrerCoordonnees(abs, ord);
		if(occupee(abs, ord)){
			abs = p.getAbscisse();
			ord = p.getOrdonnee()-1;
			recadrerCoordonnees(abs, ord);
			if(occupee(abs, ord)){
				abs = p.getAbscisse()+1;
				ord = p.getOrdonnee()-1;
				recadrerCoordonnees(abs, ord);
				if(occupee(abs, ord)){
					abs = p.getAbscisse()+1;
					ord = p.getOrdonnee();
					recadrerCoordonnees(abs, ord);
					if(occupee(abs, ord)){
						abs = p.getAbscisse()+1;
						ord = p.getOrdonnee()+1;
						recadrerCoordonnees(abs, ord);
						if(occupee(abs, ord)){
							abs = p.getAbscisse();
							ord = p.getOrdonnee()+1;
							recadrerCoordonnees(abs, ord);
							if(occupee(abs, ord)){
								abs = p.getAbscisse()-1;
								ord = p.getOrdonnee()+1;
								recadrerCoordonnees(abs, ord);
								if(occupee(abs, ord)){
									abs = p.getAbscisse()-1;
									ord = p.getOrdonnee();
									recadrerCoordonnees(abs, ord);
								}
							}
						}
					}
				}
			}
		}
	}

	public Color getColorEntite(){
		return couleur;
	}

	public int getAbscisse(){
		return abs;
	}

	public int getOrdonnee(){
		return ord;
	}

	public int recadrerAbscisse(int x){
		int temp = x;
		if(x<0)
			temp = Constantes.Largeur + x;
		if(x>Constantes.Largeur-1){
			temp = x - Constantes.Largeur;
		}
		return temp;
	}

	public int recadrerOrdonnee(int y){
		int temp = y;
		if(y<0)
			temp = Constantes.Hauteur + y;
		if(y>Constantes.Hauteur-1)
			temp = y - Constantes.Hauteur;
		return temp;
	}

	public void recadrerCoordonnees(int x,int y){
		abs = recadrerAbscisse(x);
		ord = recadrerOrdonnee(y);
	}

	//renvoie vrai si la case est occupee
	public boolean occupee(int x, int y){
		boolean occupee = false;
		int tmp = Constantes.Largeur*y + x;
		if(caseOccupees[tmp]){
			occupee = true;
		}
		return occupee;
	}


	public void ajoutCase(int pos){
		caseOccupees[pos] = true;
	}

	public int getNumeroEntite(){
		return Constantes.Largeur*ord + abs;
	}

	public void viderCase(int pos){
		caseOccupees[pos] = false;
	}
	
	public int min(int a ,int b){
		int tmp = a;
		if(a > b){
			tmp = b;
		}
		return tmp;
	}
	
	public int ajusteCaseCible(int pos){
		int x = recadrerAbscisse(retrouverAbs(pos));
		int y = recadrerOrdonnee(retrouverOrd(pos));
		return Constantes.Largeur*y + x;
	}
	
	public int retrouverAbs(int num){
		return num - retrouverOrd(num)*Constantes.Largeur;
	}
	
	public int retrouverOrd(int num){
		return num/Constantes.Largeur;
	}

}